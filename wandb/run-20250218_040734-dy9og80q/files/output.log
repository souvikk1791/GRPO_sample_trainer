Loading model ..
The model was loaded with use_flash_attention_2=True, which is deprecated and may be removed in a future release. Please use `attn_implementation="flash_attention_2"` instead.
get peft model
Creating reference model
start training
GRPO Training:   0%|                                                                                                                                                                                                                                                    | 0/4680 [00:00<?, ?it/s]Traceback (most recent call last):
running inference
running inference
completions ['system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nLegacy has 5 bars of gold she received from her father. Her friend Aleena has 2 bars fewer than she has. If a bar of gold is worth $2200, calculate the total value of gold the three have together.\n\n\n\n', "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nLegacy has 5 bars of gold she received from her father. Her friend Aleena has 2 bars fewer than she has. If a bar of gold is worth $2200, calculate the total value of gold the three have together.\n\n\nuser\nTo solve this problem, we need to first determine how many bars of gold Aleena has. Since Legacy has 5 bars and Aleena has 2 bars fewer, we can calculate the number of bars Aleena has by subtracting 2 from Legacy's number of bars. Then, we can add the number of bars Legacy and Aleena have to get the total number of bars. Finally, we can multiply the total number of bars by the value of each bar of gold to find the total value of the gold they have together.\n\nReasoning:\n1. Calculate the number of bars Aleena has: 5 (Legacy's bars) - 2 = 3 bars.\n2. Calculate the total number of bars: 5 (Legacy's bars) + 3 (Aleena's bars) = 8 bars.\n3. Calculate the total value of the gold: 8 bars * $2200/bar = $17600.\n\nAnswer:\nThe total value of gold the three have together is $17600.", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nViggo's age was 10 years more than twice his younger brother's age when his brother was 2. If his younger brother is currently 10 years old, what's the sum of theirs ages?\n\n\n\n", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nViggo's age was 10 years more than twice his younger brother's age when his brother was 2. If his younger brother is currently 10 years old, what's the sum of theirs ages?\n\n\n\n", 'system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nLegoland has 5 kangaroos for each koala. If Legoland has 180 kangaroos, how many koalas and kangaroos are there altogether?\n\nuser\nLegoland has 5 kangaroos for each koala. If Legoland has 180 kangaroos, how many koalas and kangaroos are there altogether?', 'system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nLegoland has 5 kangaroos for each koala. If Legoland has 180 kangaroos, how many koalas and kangaroos are there altogether?\n\nuser\nTo find the total number of koalas and kangaroos, we need to divide the number of kangaroos by the number of kangaroos for each koala. We can use the division algorithm to solve this problem. Can you provide the answer to this question?', 'system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nHenry went to the beach and picked up 17 perfect shells and 52 broken shells. Out of those 52 broken shells, half of them were spiral. Out of the 17 perfect shells, 12 of them were not spiral. How many more broken spiral shells were there than perfect spiral shells?\n\nuser\nTo find out how many more broken spiral shells there were than perfect spiral shells, we first need to determine how many of each type of shell Henry picked up.\n\nFor the broken shells:\nHalf of 52 broken shells are spiral, so there are 52/2 = 26 broken spiral shells.\n\nFor the perfect shells:\nOut of the 17 perfect shells, 12 of them were not spiral, so there are 17 - 12 = 5 perfect spiral shells.\n\nNow we can calculate the difference:\nNumber of broken spiral shells - Number of perfect spiral shells = 26 - 5 = 21.\n\nSo, there were 21 more broken spiral shells than perfect spiral shells.', 'system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nHenry went to the beach and picked up 17 perfect shells and 52 broken shells. Out of those 52 broken shells, half of them
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/trainer.py", line 114, in <module>
    trainer.train(dataloader, save_directory="models/")
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/grpo.py", line 283, in train
    advantages, rewards, rewards_list = self.get_advantages(
                                        ^^^^^^^^^^^^^^^^^^^^
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/grpo.py", line 96, in get_advantages
    rewards, rewards_list = total_reward(completions, **kwargs)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/utils.py", line 49, in total_reward
    correctness_reward_func(completions, **kwargs),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/utils.py", line 5, in correctness_reward_func
    return [2.0 if r == a else 0.0 for r, a in zip(extracted_responses, answer)]
                                                                        ^^^^^^
NameError: name 'answer' is not defined
