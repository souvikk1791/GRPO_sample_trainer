Loading model ..
The model was loaded with use_flash_attention_2=True, which is deprecated and may be removed in a future release. Please use `attn_implementation="flash_attention_2"` instead.
get peft model
Creating reference model
start training
GRPO Training:   0%|                                                                                                                                                                                                                                                     | 0/4680 [00:00<?, ?it/s]Traceback (most recent call last):
running inference
running inference
completions ["system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nTony has $87. He needs to buy some cheese, which costs $7 a pound and a pound of beef that costs $5 a pound. After buying the beef and his cheese, he has $61 left. How many pounds of cheese did he buy?\n\nuser\nLet's say the number of pounds of cheese Tony bought is x. The cost of x pounds of cheese would be 7x dollars. The cost of the beef would be 5x dollars. The total cost of the cheese and beef would be 7x + 5x = 12x dollars. Since Tony started with $87 and has $61 left, we can set up the equation 87 - 12x = 61. Solving this equation will give us the number of pounds of cheese Tony bought.", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nTony has $87. He needs to buy some cheese, which costs $7 a pound and a pound of beef that costs $5 a pound. After buying the beef and his cheese, he has $61 left. How many pounds of cheese did he buy?\n\nuser\nLet's set up an equation to solve this problem. Let x be the number of pounds of cheese Tony bought. The equation would be: 7x + 5(1) = 61. Solving this equation, we get x = 8. Therefore, Tony bought 8 pounds of cheese.", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nCollin learned that he could earn $0.25 per aluminum can that he brought into the recycling center.  He found 12 cans at home and three times as many at his grandparents' house.   His neighbor gave him 46.  His dad brought home 250 cans from the office.  His dad told him he could keep the money from the cans he brought home from the office if he promised to put half of his entire amount collected into savings.  How much money would Collin have to put into savings?\n\nuser\nFirst, let's calculate the total number of cans Collin brought to the recycling center. He found 12 cans at home and three times as many at his grandparents' house, so he brought 12 * 3 = 36 cans to the center. His neighbor gave him 46 cans, and his dad brought home 250 cans. \n\nSo, Collin brought a total of 12 + 36 + 46 + 250 = 344 cans to the recycling center.\n\nNext, we need to calculate how much money Collin earned from recycling. He earns $0.25 per can, so he earned 344 * $0.25 = $86.\n\nFinally, we need to calculate how much money Collin has to put into savings. He needs to keep half of his total earnings, so he would have to put $86 / 2 = $43 into savings.", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nCollin learned that he could earn $0.25 per aluminum can that he brought into the recycling center.  He found 12 cans at home and three times as many at his grandparents' house.   His neighbor gave him 46.  His dad brought home 250 cans from the office.  His dad told him he could keep the money from the cans he brought home from the office if he promised to put half of his entire amount collected into savings.  How much money would Collin have to put into savings?\n\nuser\nFirst, let's calculate the total number of cans Collin brought into the recycling center: 12 cans + 3 times as many at his grandparents' house = 12 + (3 * 12) = 12 + 36 = 48 cans.\nNext, let's calculate the total amount of money Collin earned: 48 cans * $0.25 = $12.\nCollin's dad brought home 250 cans, so he would keep 250 / 2 = 125 cans for himself.\nCollin's total savings would be the amount he earned minus the amount he kept for himself: $12 - $125 = -$113.\nTherefore, Collin would have to put $113 into savings.\nThe answer is $113.", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nuser\nThe average score on last week's Spanish test was 90.  Marco scored 10% less than the average test score and Margaret received 5 more points than Marco.  What score did Margaret receive on her test?\n\n\n\n", "system\n\nRespond in the following format:\n<reasoning>\n...\n</reasoning>\n<answer>\n...\n</answer>\n\nus
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/trainer.py", line 114, in <module>
    trainer.train(dataloader, save_directory="models/")
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/grpo.py", line 286, in train
    advantages, rewards, rewards_list = self.get_advantages(
                                        ^^^^^^^^^^^^^^^^^^^^
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/grpo.py", line 99, in get_advantages
    rewards, rewards_list = total_reward(completions, **kwargs)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/utils.py", line 49, in total_reward
    correctness_reward_func(completions, **kwargs),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jovyan/data/vision training/GRPO_sample_trainer/utils.py", line 5, in correctness_reward_func
    return [2.0 if r == a else 0.0 for r, a in zip(extracted_responses, answer)]
                                                                        ^^^^^^
NameError: name 'answer' is not defined
